// @flow
import { Model } from 'mongoose';
import { Router, Request, Response, NextFunction } from 'express';

export type ReqUser = { _id: string, role?: string };

export type CrudOptions = {
  id: string,
  data: any,
  user: ReqUser,
  files?: { [filename: string]: { path: string } }
};

export type CrudOperation = CrudOptions => Promise<any>;

export type CrudOperations = {
  getAll: CrudOptions => Promise<any[]>,
  getById: CrudOptions => Promise<any>,
  create: CrudOptions => Promise<any>,
  update: CrudOptions => Promise<any>,
  delete: CrudOptions => Promise<any>
};

export type CrudAfterObject = {
  getAll: CrudAfterMiddleware,
  getById: CrudAfterMiddleware,
  create: CrudAfterMiddleware,
  update: CrudAfterMiddleware,
  delete: CrudAfterMiddleware
};

export type PathSuffixes = {
  getAll: string,
  create: string,
};

export type Middleware = (
  req: Request,
  res: Response,
  next?: NextFunction
) => any;

export type CrudAfterMiddleware = (result: any, req: Request) => Promise<any>;

export type MongooseCrudGenerator = (
  model: Model,
  isAuthenticationActivated: boolean
) => CrudOperations;

export type CrudGenOptions = {
  path: string,
  model: Model,
  responseFormatter?: Middleware,
  pathSuffixes?: PathSuffixes,
  before?: CrudOperations,
  after?: CrudAfterObject,
  isAuthenticationActivated?: boolean
};

export type ExpressCrudGenerator = ({
  operations: CrudOperations,
  responseFormatter?: Middleware,
  pathSuffixes?: PathSuffixes,
  before?: CrudOperations,
  after?: CrudAfterObject
}) => Router;
